<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Log in â€” Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="auth-page">
  <div class="auth-wrap">
    <div class="auth-box">
      <h1>Log in</h1>
      <p class="auth-sub">Access your leads dashboard.</p>
      <div id="errorMessage" class="error-message" style="display: none;"></div>
      <form id="loginForm">
        <div class="form-group">
          <label for="email">Email *</label>
          <input type="email" id="email" name="email" required placeholder="you@example.com" autocomplete="email">
        </div>
        <div class="form-group">
          <label for="password">Password *</label>
          <input type="password" id="password" name="password" required placeholder="Your password" autocomplete="current-password">
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-submit">Log in</button>
        </div>
      </form>
      <p class="auth-footer">Don't have an account? <a href="signup.html">Sign up</a></p>
    </div>
  </div>
  <script>
    var API = window.location.origin;

    function showError(message) {
      var errorEl = document.getElementById('errorMessage');
      if (errorEl) {
        errorEl.textContent = message;
        errorEl.style.display = 'block';
      }
    }

    function hideError() {
      var errorEl = document.getElementById('errorMessage');
      if (errorEl) {
        errorEl.style.display = 'none';
      }
    }

    document.getElementById('loginForm').addEventListener('submit', function (e) {
      e.preventDefault();
      hideError();
      
      var email = document.getElementById('email').value.trim();
      var password = document.getElementById('password').value;

      if (!email || !password) {
        showError('Please fill in all fields.');
        return;
      }

      var btn = this.querySelector('.btn-submit');
      btn.disabled = true;
      btn.textContent = 'Logging in...';

      fetch(API + '/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: email, password: password })
      })
        .then(function (res) {
          return res.json()
            .then(function (data) {
              return { ok: res.ok, status: res.status, data: data };
            })
            .catch(function () {
              return { ok: false, status: res.status, data: { detail: 'Invalid response from server' } };
            });
        })
        .then(function (r) {
          if (r.ok && r.data.access_token) {
            localStorage.setItem('token', r.data.access_token);
            window.location.href = 'index.html';
            return;
          }
          var errorMsg = r.data.detail || r.data.message || 'Log in failed. Please check your credentials.';
          showError(errorMsg);
        })
        .catch(function (err) {
          console.error(err);
          showError('Log in failed. Is the backend running? Check the console for details.');
        })
        .finally(function () {
          btn.disabled = false;
          btn.textContent = 'Log in';
        });
    });
  </script>
</body>
</html>
