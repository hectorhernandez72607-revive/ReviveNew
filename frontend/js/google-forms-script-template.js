/**
 * Google Apps Script template. Replace {{BACKEND_BASE}} and {{CLIENT_SLUG}} before showing/copying.
 */
window.GOOGLE_FORMS_SCRIPT_TEMPLATE = [
  "/**",
  " * Google Apps Script for Google Forms Integration",
  " * Paste this into your form's Script editor. Set BACKEND_BASE and CLIENT_SLUG as needed.",
  " */",
  "",
  "var BACKEND_BASE = \"{{BACKEND_BASE}}\";",
  "var CLIENT_SLUG = \"{{CLIENT_SLUG}}\";",
  "var WEBHOOK_URL = BACKEND_BASE + \"/webhook/lead/\" + CLIENT_SLUG;",
  "",
  "function onFormSubmit(e) {",
  "  try {",
  "    var formResponse = e.response;",
  "    var itemResponses = formResponse.getItemResponses();",
  "    var name = \"\";",
  "    var email = \"\";",
  "    var phone = \"\";",
  "    itemResponses.forEach(function(itemResponse) {",
  "      var questionTitle = itemResponse.getItem().getTitle().toLowerCase();",
  "      var answer = itemResponse.getResponse();",
  "      if (questionTitle.indexOf(\"name\") !== -1 || questionTitle.indexOf(\"full name\") !== -1 || questionTitle.indexOf(\"first name\") !== -1 || questionTitle.indexOf(\"last name\") !== -1) name = answer;",
  "      if (questionTitle.indexOf(\"email\") !== -1 || questionTitle.indexOf(\"e-mail\") !== -1 || questionTitle.indexOf(\"email address\") !== -1) email = answer;",
  "      if (questionTitle.indexOf(\"phone\") !== -1 || questionTitle.indexOf(\"phone number\") !== -1 || questionTitle.indexOf(\"telephone\") !== -1) phone = answer;",
  "    });",
  "    if (!name || !email) {",
  "      Logger.log(\"ERROR: Missing required fields (name or email)\");",
  "      return;",
  "    }",
  "    var payload = { name: name, email: email, phone: phone || \"\", source: \"Google Forms\" };",
  "    var options = { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, payload: JSON.stringify(payload), muteHttpExceptions: true };",
  "    var response = UrlFetchApp.fetch(WEBHOOK_URL, options);",
  "    var code = response.getResponseCode();",
  "    if (code === 200) Logger.log(\"Success! Lead sent: \" + name + \" (\" + email + \")\");",
  "    else Logger.log(\"Error \" + code + \": \" + response.getContentText());",
  "  } catch (err) {",
  "    Logger.log(\"Exception: \" + err.toString());",
  "  }",
  "}",
  "",
  "function testWebhook() {",
  "  var mockEvent = {",
  "    response: {",
  "      getItemResponses: function() {",
  "        return [",
  "          {",
  "            getItem: function() { return { getTitle: function() { return \"Full Name\"; } }; },",
  "            getResponse: function() { return \"Test User\"; }",
  "          },",
  "          {",
  "            getItem: function() { return { getTitle: function() { return \"Email Address\"; } }; },",
  "            getResponse: function() { return \"test@example.com\"; }",
  "          }",
  "        ];",
  "      }",
  "    }",
  "  };",
  "  Logger.log(\"Running test...\");",
  "  onFormSubmit(mockEvent);",
  "  Logger.log(\"Test complete. Check logs above.\");",
  "}"
].join("\n");
